syntax = "proto3";

package rag;

// Go package option
option go_package = "./pb";

// --------------------------------------------------------
// RAG Service Definition
// --------------------------------------------------------
service RagService {
  /// Chat is an RPC that processes a user's query and returns a response.
  /// It takes a ChatRequest containing the query, session ID, and configuration,
  /// and returns a ChatResponse with the generated answer and source documents.
  rpc Chat (ChatRequest) returns (stream ChatResponse);

  /// UploadDocument is an RPC that handles document uploads.
  /// It takes an UploadRequest with file details and content,
  /// and returns an UploadResponse indicating the status of the upload.
  rpc UploadDocument (UploadRequest) returns (UploadResponse);
}

// --------------------------------------------------------
// Request Message Definitions
// --------------------------------------------------------
message ChatRequest {
  string      query      = 1; // User's question
  string      session_id = 2; // Unique session identifier
  QueryConfig config     = 3; // Retrieval configuration
}

message QueryConfig {
  string collection_name = 1; // Name of the document collection
  int32  max_results     = 2; // Maximum number of source documents to retrieve
}

// --------------------------------------------------------
// Response Message Definitions
// --------------------------------------------------------
message ChatResponse {
  string          answer             = 1; // Generated answer
  repeated Source source_documents   = 2; // Retrieved source documents
  double          processing_time_ms = 3; // Processing time in milliseconds
}

message Source {
  string filename    = 1; // Name of the source document
  int32  page_number = 2; // Page number in the document
  string snippet     = 3; // Relevant text snippet
  float  score       = 4; // Relevance score
}

// --------------------------------------------------------
// Upload Message Definitions
// --------------------------------------------------------
message UploadRequest {
  string filename     = 1; // Name of the file being uploaded
  string content_type = 2; // MIME type of the file (e.g., application/pdf)
  bytes  file_content = 3; // Binary content of the file
}

message UploadResponse {
  string status       = 1; // Status message
  int32  chunks_count = 2; // Number of chunks created from the file
  string message      = 3; // Additional information or error message
}