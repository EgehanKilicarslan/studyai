syntax = "proto3";

package rag;

// Go package option
option go_package = "./pb";

// --------------------------------------------------------
// Chat Service Definition
// --------------------------------------------------------
service ChatService {
  /// Chat is an RPC that processes a user's query and returns a response.
  /// It takes a ChatRequest containing the query, session ID, and configuration,
  /// and returns a ChatResponse with the generated answer and source documents.
  rpc Chat (ChatRequest) returns (stream ChatResponse);
}

// --------------------------------------------------------
// Knowledge Base Service Definition
// --------------------------------------------------------
service KnowledgeBaseService {
  /// ProcessDocument is an RPC that processes a document that was already saved by Go.
  /// Go provides the document_id, file_path, and metadata. Python processes and indexes it.
  rpc ProcessDocument (ProcessDocumentRequest) returns (ProcessDocumentResponse);

  /// DeleteDocument is an RPC that deletes a specified document from the vector store.
  /// It takes a DeleteDocumentRequest and returns a DeleteDocumentResponse.
  rpc DeleteDocument (DeleteDocumentRequest) returns (DeleteDocumentResponse);
}

// --------------------------------------------------------
// Request Message Definitions
// --------------------------------------------------------
message ChatRequest {
  string query      = 1; // User's question
  string session_id = 2; // Unique session identifier

}

// --------------------------------------------------------
// Response Message Definitions
// --------------------------------------------------------
message ChatResponse {
  string          answer             = 1; // Generated answer
  repeated Source source_documents   = 2; // Retrieved source documents
  double          processing_time_ms = 3; // Processing time in milliseconds
}

message Source {
  string document_id = 1; // Unique identifier for the source document
  string filename    = 2; // Name of the source document
  int32  page_number = 3; // Page number in the document
  string snippet     = 4; // Relevant text snippet
  float  score       = 5; // Relevance score
}

// --------------------------------------------------------
// Process Document Message Definitions (Go -> Python)
// --------------------------------------------------------
message ProcessDocumentRequest {
  string document_id     = 1; // UUID assigned by Go (source of truth)
  string file_path       = 2; // Path to the file on disk
  string filename        = 3; // Original filename
  string content_type    = 4; // MIME type of the file
  uint32 organization_id = 5; // Organization ID for multi-tenancy
  uint32 group_id        = 6; // Group ID (0 if org-wide)
  uint32 owner_id        = 7; // Owner user ID
}

message ProcessDocumentResponse {
  string document_id  = 1; // Echo back the document ID
  string status       = 2; // "success", "error"
  int32  chunks_count = 3; // Number of chunks created
  string message      = 4; // Additional info or error message
}

// --------------------------------------------------------
// Delete Document Message Definitions
// --------------------------------------------------------
message DeleteDocumentRequest {
  string document_id = 1; // Unique identifier for the document to be deleted
}

message DeleteDocumentResponse {
  string status  = 1; // Status message
  string message = 2; // Additional information or error message
}